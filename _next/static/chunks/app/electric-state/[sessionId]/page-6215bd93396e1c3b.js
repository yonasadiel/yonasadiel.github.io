(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[69],{3225:function(e,s,t){Promise.resolve().then(t.bind(t,7762)),Promise.resolve().then(t.bind(t,3569))},7762:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(7437),l=t(3569),r=t(4033);function n(e){let{sessionId:s}=e,t=(0,r.useSearchParams)(),n=t.get("name"),i=t.get("token");return(0,a.jsx)(l.default,{sessionId:s,travelerName:n,token:i})}},3569:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var a=t(7437),l=t(9650),r=t.n(l),n=t(4006),i=t.n(n),c=t(7063),o=t.n(c),d=t(2265);function m(e){let{combat:s,isDM:t}=e,l=(0,d.useRef)(null),[r,n]=(0,d.useState)(null),[i,c]=(0,d.useState)(null);return((0,d.useEffect)(()=>{if(!l.current)return;let e=()=>{var e;let s=null===(e=l.current)||void 0===e?void 0:e.getBoundingClientRect();s&&n({x:s.width,y:s.height})};e();let s=new ResizeObserver(e);return s.observe(l.current),()=>{s.disconnect()}},[]),s.active)?(0,a.jsxs)("div",{className:"p-2 h-full flex flex-col justify-center items-center",children:[(0,a.jsxs)("div",{className:"flex-0 mt-4 mb-4 text-xl font-bold",children:["Current Turn: ",s.currentTurn]}),(0,a.jsx)("div",{className:"flex-1 flex justify-center items-center overflow-hidden relative w-full h-full",children:(0,a.jsxs)("div",{className:"relative h-full",children:[(0,a.jsx)("img",{ref:l,src:s.map.url,alt:"Combat Map",className:"w-full h-full object-contain",onMouseMove:e=>{if(!r)return;let t=e.currentTarget.getBoundingClientRect(),a=e.clientX-t.left,l=t.height-(e.clientY-t.top),n=Math.floor(a/(t.width/s.map.gridX)),i=Math.floor(l/(t.height/s.map.gridY));n>=0&&n<s.map.gridX&&i>=0&&i<s.map.gridY?c({x:n,y:i}):c(null)},onMouseLeave:()=>c(null)}),r&&s.turns.map(e=>{if(!r)return null;let t=r.x/s.map.gridX,l=r.y/s.map.gridY,n=(e.posX+s.map.offsetX)*t,i=r.y-(e.posY+s.map.offsetY+1)*l;return(0,a.jsx)("div",{className:"absolute rounded-full border-2 ".concat("alive"===e.state?"bg-green-500 border-green-700":"incapacitated"===e.state?"bg-yellow-500 border-yellow-700":"bg-red-500 border-red-700"),style:{width:.6*t,height:.6*t,left:n+.2*t,top:i+.2*l,transition:"all 0.3s ease-in-out"},children:(0,a.jsx)("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2 text-xs whitespace-nowrap",children:e.name})},e.name)}),t&&i&&(0,a.jsxs)("div",{className:"absolute bottom-2 left-2 bg-black/50 text-white px-2 py-1 rounded text-sm",children:["x: ",i.x,", y: ",i.y]})]})})]}):null}var x=t(1238),u=t.n(x);function h(e){let{style:s,imgRef:t,...l}=e,[r,n]=(0,d.useState)(!1);return(0,a.jsx)("img",{...l,ref:t,style:{...s,opacity:r?1:0,transition:"opacity 2s cubic-bezier(0.4, 0, 0.2, 1)"},onLoad:()=>n(!0)})}let p=["amber-500","blue-400"];function f(e){var s,t,l;let{maps:r,isDM:n}=e,i=(0,d.useRef)(null),c=(0,d.useRef)(null),[o,m]=(0,d.useState)(r[0].title),[x,f]=(0,d.useState)(null),[b,j]=(0,d.useState)(null),[g,v]=(0,d.useState)(null),N=r.find(e=>e.title===o);return(0,d.useEffect)(()=>{if(!(null==i?void 0:i.current)||!(null==c?void 0:c.current))return;let e=()=>{var e,s;let t=null===(e=i.current)||void 0===e?void 0:e.getBoundingClientRect(),a=null===(s=c.current)||void 0===s?void 0:s.getBoundingClientRect();t&&a&&(v({x:t.width,y:t.height}),j({x:t.left-a.left,y:t.top-a.top}))};e();let s=new ResizeObserver(e);return s.observe(c.current),()=>s.disconnect()},[null==i?void 0:i.current,null==c?void 0:c.current]),(0,a.jsxs)("div",{className:"p-2 h-full flex flex-col justify-center items-center",children:[(0,a.jsx)("div",{className:"flex-0 mt-4 mb-4 text-xl font-bold divide-x-4 flex flex-row",children:r.map(e=>(0,a.jsx)("span",{children:(0,a.jsx)("h3",{className:"inline mx-2 cursor-pointer transition-all duration-300 ease-in-out hover:opacity-70 ".concat(o===e.title?"border-b-4":""),onClick:()=>m(e.title),children:e.title})},e.title))}),(0,a.jsxs)("div",{ref:c,className:"flex-1 flex justify-center items-center overflow-hidden relative w-full h-full",children:[!!N&&(0,a.jsx)(h,{imgRef:i,src:N.url,alt:"Map of ".concat(o),className:"".concat(u().animateFadeIn," max-w-full max-h-full object-contain transition-transform duration-300"),onMouseMove:e=>{let s=e.currentTarget.getBoundingClientRect(),t=Math.round(e.clientX-s.left),a=Math.round(e.clientY-s.top);N&&t>=0&&t<=s.width&&a>=0&&a<=s.height?f({x:Math.floor(a*N.maxY/s.width),y:Math.floor(t*N.maxY/s.width)}):f(null)},onMouseLeave:()=>f(null)}),(0,a.jsx)("div",{className:"bg-amber-500 bg-blue-400"})," ",!!N&&!!(null==g?void 0:g.x)&&(null!==(s=N.pois)&&void 0!==s?s:[]).map((e,s)=>{var t,l,r,n,i,c,o,d;return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"absolute size-2 rounded-full shadow-sm shadow-black bg-".concat(p[s]),style:{top:(null!==(t=e.x)&&void 0!==t?t:0)*g.x/N.maxY+(null!==(l=null==b?void 0:b.y)&&void 0!==l?l:0),left:(null!==(r=e.y)&&void 0!==r?r:0)*g.x/N.maxY+(null!==(n=null==b?void 0:b.x)&&void 0!==n?n:0)}}),(0,a.jsx)("div",{className:"absolute border-white px-1 text-xs rounded-sm shadow-sm shadow-black bg-".concat(p[s]),style:{top:(null!==(i=e.x)&&void 0!==i?i:0)*g.x/N.maxY+(null!==(c=null==b?void 0:b.y)&&void 0!==c?c:0)+15,left:(null!==(o=e.y)&&void 0!==o?o:0)*g.x/N.maxY+(null!==(d=null==b?void 0:b.x)&&void 0!==d?d:0)+15},children:e.name})]},e.name)})]}),n&&(0,a.jsx)("div",{className:"flex-0 mt-4 mb-4 text-sm font-bold divide-x-4 flex flex-row",children:(0,a.jsxs)("span",{children:["x: ",null!==(t=null==x?void 0:x.x)&&void 0!==t?t:"-",", y: ",null!==(l=null==x?void 0:x.y)&&void 0!==l?l:"-"]})})]})}function b(e){let{story:s}=e,[t,l]=(0,d.useState)(""),r=e=>{l(t===e?"":e)};return(0,a.jsx)("div",{className:"p-8 divide-y-4",children:s.map(e=>(0,a.jsx)("div",{className:"mb-4 border-black",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl mb-3 font-semibold cursor-pointer flex items-center transition-transform duration-1000",onClick:()=>r(e.title),children:[(0,a.jsx)("span",{className:"mr-2 w-4 transition-transform duration-300 ".concat(t===e.title?"rotate-0":"-rotate-90"),children:"▼"}),e.title]}),(0,a.jsx)("div",{className:"overflow-hidden transition-all duration-1000 ease-in-out ".concat(t===e.title?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"),children:(0,a.jsx)("div",{className:"mb-4",children:e.story.split("\n").map(e=>(0,a.jsx)("p",{className:"mb-2",children:e},e))})})]})},e.title))})}var j=t(8406),g=t.n(j);function v(e){return e<0?e.toString():"+".concat(e)}function N(e){let{travelerName:s,travelers:t}=e,[l,r]=(0,d.useState)(s),n=(0,d.useRef)(null);if("DM"===s)return(0,a.jsx)("div",{className:"p-8 grid grid-cols-3 gap-x-4",ref:n,children:t.map(e=>(0,a.jsx)("div",{className:"flex flex-col",children:(0,a.jsx)(y,{traveler:e,isOwnedTraveler:!1,onSwitchToTraveler:()=>{}})},e.name))});let i=t.find(e=>e.name===l);if(!i)return null;let c=e=>{r(e),n.current&&n.current.scrollIntoView({behavior:"smooth"})};return(0,a.jsx)("div",{className:"p-8",ref:n,children:(0,a.jsx)(y,{traveler:i,isOwnedTraveler:i.name===s,onSwitchToOwnedTraveler:()=>c(s),onSwitchToTraveler:e=>c(e)})})}let y=e=>{let{traveler:s,isOwnedTraveler:t,onSwitchToOwnedTraveler:l,onSwitchToTraveler:r}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-col justify-between items-center mb-6",children:[(0,a.jsx)("small",{className:"w-full mb-2 underline",onClick:l,children:!t&&l?"← Back to your character":""}),(0,a.jsxs)("h2",{className:"text-2xl font-bold",children:[s.name," ",t?"(You)":""]})]}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"pb-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold whitespace-nowrap",children:"Basic Info"}),(0,a.jsx)("span",{className:"ml-3 w-full h-0 border-b-4 border-black"})]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Archetype:"})," ",s.archetype]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Dream:"})," ",s.dream]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Flaw:"})," ",s.flaw]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold whitespace-nowrap",children:"Stats"}),(0,a.jsx)("span",{className:"ml-3 w-full h-0 border-b-4 border-black"})]}),(0,a.jsx)("div",{className:"grid grid-cols-4 gap-2",children:["str","agi","wit","emp"].map(e=>(0,a.jsxs)("div",{className:"p-2 border-4 border-black text-center",children:[(0,a.jsx)("p",{className:"mb-1",children:(0,a.jsx)("strong",{children:e.toUpperCase()})}),(0,a.jsx)("p",{className:"mb-0 text-xl",children:s.stats[e]}),!!s.state.statsModifier[e]&&(0,a.jsxs)("small",{className:"mb-0 text-sm text-gray-600",children:["(",s.state.statsModifier[e],")"]})]},e))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold whitespace-nowrap",children:"Current State"}),(0,a.jsx)("span",{className:"ml-3 w-full h-0 border-b-4 border-black"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2",children:[(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Health:"})," ",s.state.health," / ",Math.ceil((s.stats.str+s.stats.agi)/2)]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Hope:"})," ",s.state.hope," / ",Math.ceil((s.stats.wit+s.stats.emp)/2)]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Bliss:"})," ",s.state.bliss]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Cash:"})," $",s.state.cash]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-center items-center mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold whitespace-nowrap",children:"Neurocaster"}),(0,a.jsx)("span",{className:"ml-3 w-full h-0 border-b-4 border-black"})]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Name:"})," ",s.neurocaster.name]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Price:"})," $",s.neurocaster.price]}),(0,a.jsxs)("div",{className:"grid grid-cols-2",children:[(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Processor:"})," ",v(s.neurocaster.processor)]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Network:"})," ",v(s.neurocaster.network)]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Graphics:"})," ",v(s.neurocaster.graphics)]}),(0,a.jsxs)("p",{className:"mb-0",children:[(0,a.jsx)("strong",{children:"Mobility:"})," ",v(s.neurocaster.mobility)]})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Talents"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(s.talents||[]).map(e=>(0,a.jsxs)("div",{className:"border-4 border-black p-3",children:[(0,a.jsx)("p",{className:"font-semibold mb-1",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]},e.title))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Personal Items"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:(s.personalItem||[]).map((e,s)=>(0,a.jsxs)("div",{className:"border-4 border-black p-3",children:[(0,a.jsxs)("p",{className:"font-semibold",children:[e.name," (",e.type,")"]}),"gear"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.description}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Bonus"}),": ",void 0===e.bonus?"-":v(e.bonus)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Used"}),": ",void 0===e.used?"inf":e.used]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Price:"})," $",e.price]})]}),"weapon"===e.type&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Damage"}),": ",e.damage]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Bonus"}),": ",v(e.bonus)]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Min Range"}),": ",e.minRange]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Max Range"}),": ",e.maxRange]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,a.jsx)("strong",{children:"Price"}),": $",e.price]})]})]},s))})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Tensions"}),(0,a.jsx)("div",{className:"grid grid-cols-1 gap-4",children:Object.keys(s.state.tensions).map(e=>(0,a.jsxs)("div",{className:"border-4 border-black p-3 flex flex-row items-center",onClick:()=>r(e),children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("p",{className:"font-semibold mb-1",children:[e,": ",s.state.tensions[e].level," / 2"]}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:s.state.tensions[e].description})]}),(0,a.jsx)("div",{className:"".concat(g().arrowRight," ")})]},e))})]})]})})]})},_="Story",w="Travelers",k=[_,w,"Map"];function S(e){let{sessionId:s,travelerName:t,sessionData:l}=e,[r,n]=(0,d.useState)(_);return(0,a.jsxs)("div",{className:o().book,children:[(0,a.jsxs)("div",{className:o().content,children:[(0,a.jsx)("div",{className:o().page,children:(()=>{switch(r){case _:return(0,a.jsx)(b,{story:l.story});case w:return(0,a.jsx)(N,{travelerName:t,travelers:l.travelers});case"Map":return(0,a.jsx)(f,{isDM:"DM"===t,maps:l.maps});case"Combat":return l.combat?(0,a.jsx)(m,{isDM:"DM"===t,combat:l.combat}):null;default:return null}})()}),(0,a.jsx)("div",{className:"".concat(o().page," ").concat(o().other1)}),(0,a.jsx)("div",{className:"".concat(o().page," ").concat(o().other2)})]}),(0,a.jsx)("div",{className:o().bookmarks,children:k.map(e=>(0,a.jsx)("div",{className:"".concat(o().bookmark," ").concat(r===e?o().active:""),onClick:()=>n(e),children:e},e))})]})}var M=t(4990),C=t.n(M);function R(e){let{title:s,travelerName:t,error:l,loading:r,onStart:n}=e;return(0,a.jsx)("div",{className:C().welcomeContainer,children:(0,a.jsxs)("div",{className:C().innerBox,children:[(0,a.jsx)("h1",{children:s}),(0,a.jsxs)("p",{children:["Welcome, ",t||"traveler","."]}),r&&(0,a.jsx)("p",{children:"Loading..."}),!r&&l&&(0,a.jsx)("small",{children:l}),!r&&!l&&(0,a.jsx)("button",{type:"button",onClick:n,children:"Resume your journey"})]})})}var B=t(1693);let I="electric-state-session";function T(e){let{sessionId:s,travelerName:t,token:l}=e,[n,c]=(0,d.useState)(!1),{sessionData:o,isLoading:m,error:x}=function(e){let{sessionId:s,travelerName:t,token:a}=e,[l,r]=(0,d.useState)(null),{data:n,isLoading:i,isSuccess:c,error:o}=(0,B.kq)({sessionId:s,travelerName:t||"",token:a||""},{skip:!t||!a}),{data:m,isLoading:x,error:u}=(0,B.EU)({sessionId:s,travelerName:t||"",token:a||""},{skip:!0,pollingInterval:1e4});return(0,d.useEffect)(()=>{new Promise((e,t)=>{try{let t=localStorage.getItem("".concat(I,"-").concat(s));t&&e(JSON.parse(t))}catch(e){t("Error loading from localStorage: "+e)}}).then(e=>r(e))},[s]),(0,d.useEffect)(()=>{let e=null!=m?m:n;e&&(new Promise((t,a)=>{try{localStorage.setItem("".concat(I,"-").concat(s),JSON.stringify(e)),t()}catch(e){a("Error saving to localStorage: "+e)}}),r(e))},[n,m,s]),{sessionData:l,isLoading:!l,error:t&&a?o?"Failed fetching session data "+(null!=o?o:u):"":"This is a page to play Electric State RPG."}}({sessionId:s,travelerName:t,token:l});return(0,a.jsxs)("div",{className:"".concat(i().hecate," ").concat(r().className),children:[(0,a.jsx)("div",{className:i().backgroundImage,children:!!(null==o?void 0:o.backgroundImage)&&(0,a.jsx)(h,{className:"w-full h-full object-cover",alt:"background art",src:o.backgroundImage})}),(0,a.jsx)("div",{className:"".concat(i().welcomePage," ").concat(n?i().fadeOut:""),children:(0,a.jsx)(R,{title:s.replace(/-/g," ").replace(/\w\S*/g,e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()),travelerName:t||"traveler",error:x,loading:m,onStart:()=>c(!0)})}),(0,a.jsx)("div",{className:"".concat(i().bookWrapper," ").concat(n?i().slideIn:""),children:n&&!m&&!!o&&(0,a.jsx)(S,{sessionId:s,travelerName:t||"",sessionData:o})})]})}},1693:function(e,s,t){"use strict";t.d(s,{EU:function(){return c},R_:function(){return r},kq:function(){return i},wW:function(){return n}});var a=t(5687),l=t(5345);let r=(0,a.LC)({reducerPath:"sessionApi",baseQuery:(0,l.ni)({baseUrl:"https://script.google.com/macros/s/AKfycbw0oyp5QbpRFkU3WiockTZ3bSukYBEJDx_AZR7WiAVKUB0ug_RD0OnSpYIuGB4--wHq/"}),endpoints:e=>({getSessionData:e.query({query:e=>{let{sessionId:s,travelerName:t,token:a}=e;return{url:"exec",params:{action:"getSession",session:s,name:t,token:a}}}})})}),n=(0,a.LC)({reducerPath:"dynamicSessionApi",baseQuery:(0,l.ni)({baseUrl:"https://ctf-tunnel.yonasadiel.com/api/electric-state/"}),endpoints:e=>({getSessionData:e.query({query:e=>{let{sessionId:s,travelerName:t,token:a}=e;return{url:"session/".concat(s),params:{name:t,token:a}}}})})}),{useGetSessionDataQuery:i}=r,{useGetSessionDataQuery:c}=n},4006:function(e){e.exports={hecate:"styles_hecate__Z8l_H",backgroundImage:"styles_backgroundImage__6xoJD",welcomePage:"styles_welcomePage__NthuF",fadeOut:"styles_fadeOut__ZRrSn",bookWrapper:"styles_bookWrapper__NvYHX",slideIn:"styles_slideIn__LLNy3"}},4990:function(e){e.exports={welcomeContainer:"WelcomePage_welcomeContainer__mFzyj",innerBox:"WelcomePage_innerBox__mBmgX"}},7063:function(e){e.exports={book:"Book_book__KcqXP",bookmarks:"Book_bookmarks___CWR9",bookmark:"Book_bookmark__Tt5XX",active:"Book_active__rsNMg",content:"Book_content__Jpkrq",page:"Book_page__ylF_m",other1:"Book_other1__N7C9p",other2:"Book_other2__vXbN9"}},1238:function(e){e.exports={animateFadeIn:"Map_animateFadeIn__KNukM",fadeIn:"Map_fadeIn__6FvBI"}},8406:function(e){e.exports={arrowRight:"Travelers_arrowRight__koYbi",travelerSection:"Travelers_travelerSection__NxD38"}},9650:function(e){e.exports={style:{fontFamily:"'__Open_Sans_4dd805', '__Open_Sans_Fallback_4dd805'",fontStyle:"normal"},className:"__className_4dd805"}},4033:function(e,s,t){e.exports=t(5313)}},function(e){e.O(0,[52,971,938,744],function(){return e(e.s=3225)}),_N_E=e.O()}]);